from flask import Flask, render_template, request,  redirect #, url_for, request
from werkzeug.utils import secure_filename
import os


def build_model():
    print("here we can build the model and save using pickle.\n so that we need not rebuild everytime while malware detection.")
    return

def malware_detection(filein):
    print("here we will predict the given file for presence of malware.\n will return 1 if yes or 0")
    return 0
        
   
app = Flask(__name__)
app.static_folder = 'static'
app.config['SECRET_KEY']='supersecretkey'
app.config['UPLOAD_FOLDER']='./static/UploadFiles'


@app.route('/')
def home():
    return render_template("index.html")

@app.route('/upload')
def upload():
    return render_template("upload.html")


# ******Phrase level sentiment analysis
@app.route("/scan", methods=['POST','GET'])
def scan():
    res_predict="unknown"
    if request.method=='POST':
        filein=request.files['fileInput']
        if filein.filename =='':
            print("image must have a filename")
            return render_template("upload.html",msg="No file uploaded")
       

        filename = secure_filename(filein.filename)
        basedir = os.path.abspath(os.path.dirname(__file__))
        filein.save(os.path.join(basedir, app.config["UPLOAD_FOLDER"], filename))
         
        res_p =  malware_detection(filename) 
        print("file is uploaded")
        if res_p == 1:
            res_predict = "Malware Detected in "+filename
        else :
            res_predict= "No Malware Present in "+filename
        #print(res_predict)
        return render_template('result.html', result=res_predict,name = filename.split('.')[0])

 
if __name__ == '__main__':
    '''
    import os
    path='./random_forest.joblib'
    if not os.path.exists(path):
        build_model()
    '''
    build_model()
    app.debug=True
    app.run(host='localhost')

